generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// *
///  * =======================
///  * USUÁRIO
///  * =======================
model Usuario {
  id           String       @id @default(uuid())
  nome         String
  email        String       @unique
  senha        String
  documento    String       @unique
  telefone     String?      
  papel        PapelUsuario @default(USUARIO)
  criadoEm     DateTime     @default(now())
  atualizadoEm DateTime     @updatedAt
  carrinho     Carrinho?
  enderecos    Endereco[]
  favoritos    Favorito[]
  feedbacks    Feedback[]
  pedidos      Pedido[]
}

model Favorito {
  id        String   @id @default(uuid())
  usuarioId String
  produtoId String
  criadoEm  DateTime @default(now())
  produto   Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, produtoId])
}

/// *
///  * =======================
///  * ENDEREÇO
///  * =======================
model Endereco {
  id          String   @id @default(uuid())
  usuarioId   String
  rua         String
  numero      String
  complemento String?
  bairro      String
  cidade      String
  estado      String
  cep         String
  criadoEm    DateTime @default(now())
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
}

/// *
///  * =======================
///  * CATEGORIA
///  * =======================
model Categoria {
  id       String    @id @default(uuid())
  nome     String
  slug     String    @unique
  criadoEm DateTime  @default(now())
  produtos Produto[]
}

/// *
///  * =======================
///  * PRODUTO
///  * =======================
model Produto {
  id               String            @id @default(uuid())
  nome             String
  descricao        String
  preco            Decimal           @db.Decimal(10, 2)
  emPromocao       Boolean           @default(false)
  precoPromocional Decimal?          @db.Decimal(10, 2)
  slug             String            @unique
  imagemUrl        String
  imagemUrls       String[]
  categoriaId      String
  criadoEm         DateTime          @default(now())
  atualizadoEm     DateTime          @updatedAt
  estrelas         Float             @default(0)
  imagemPublicId   String?
  imagemPublicIds  String[]
  favoritos        Favorito[]
  feedbacks        Feedback[]
  categoria        Categoria         @relation(fields: [categoriaId], references: [id])
  variacoes        ProdutoVariacao[]
}

/// *
///  * =======================
///  * VARIAÇÃO DO PRODUTO (TAMANHO)
///  * =======================
model ProdutoVariacao {
  id            String         @id @default(uuid())
  produtoId     String
  tipoTamanho   TipoTamanho
  tamanho       String
  estoque       Int
  sku           String         @unique
  criadoEm      DateTime       @default(now())
  cores         String[]
  itensCarrinho CarrinhoItem[]
  itensPedido   PedidoItem[]
  produto       Produto        @relation(fields: [produtoId], references: [id], onDelete: Cascade)
}

/// *
///  * =======================
///  * CARRINHO
///  * =======================
model Carrinho {
  id           String         @id @default(uuid())
  usuarioId    String         @unique
  criadoEm     DateTime       @default(now())
  atualizadoEm DateTime       @updatedAt
  usuario      Usuario        @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  itens        CarrinhoItem[]
}

/// *
///  * =======================
///  * ITEM DO CARRINHO
///  * =======================
model CarrinhoItem {
  id                String          @id @default(uuid())
  quantidade        Int
  carrinhoId        String
  produtoVariacaoId String
  criadoEm          DateTime        @default(now())
  carrinho          Carrinho        @relation(fields: [carrinhoId], references: [id])
  produtoVariacao   ProdutoVariacao @relation(fields: [produtoVariacaoId], references: [id], onDelete: Cascade)
}

/// *
///  * =======================
///  * PEDIDO
///  * =======================
model Pedido {
  id                      String       @id @default(uuid())
  usuarioId               String
  status                  StatusPedido @default(PENDENTE)
  total                   Decimal      @db.Decimal(10, 2)
  rua                     String
  numero                  String
  complemento             String?
  bairro                  String
  cidade                  String
  estado                  String
  cep                     String
  criadoEm                DateTime     @default(now())
  atualizadoEm            DateTime     @updatedAt
  label_url               String?
  melhorenvio_purchase_id String?
  melhorenvio_service_id  Int?
  melhorenvio_shipment_id String?
  shipping_metadata       Json?
  shipping_status         String?
  tracking_number         String?
  pagamento               Pagamento?
  usuario                 Usuario      @relation(fields: [usuarioId], references: [id])
  itens                   PedidoItem[]
}

/// *
///  * =======================
///  * ITEM DO PEDIDO
///  * =======================
model PedidoItem {
  id                String          @id @default(uuid())
  quantidade        Int
  preco             Decimal         @db.Decimal(10, 2)
  pedidoId          String
  produtoVariacaoId String
  pedido            Pedido          @relation(fields: [pedidoId], references: [id])
  produtoVariacao   ProdutoVariacao @relation(fields: [produtoVariacaoId], references: [id], onDelete: Cascade)
}

/// *
///  * =======================
///  * PAGAMENTO
///  * =======================
model Pagamento {
  id          String          @id @default(uuid())
  pedidoId    String          @unique
  provedor    String
  pagamentoId String
  status      StatusPagamento
  criadoEm    DateTime        @default(now())
  pedido      Pedido          @relation(fields: [pedidoId], references: [id])
}

/// *
///  * =======================
///  * FEEDBACK / AVALIAÇÃO
///  * =======================
model Feedback {
  id           String   @id @default(uuid())
  usuarioId    String
  produtoId    String
  estrelas     Float    @default(0.0)
  comentario   String?
  criadoEm     DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  produto      Produto  @relation(fields: [produtoId], references: [id])
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, produtoId])
}

/// *
///  * =======================
///  * ENUMS
///  * =======================
enum PapelUsuario {
  USUARIO
  ADMIN
}

enum StatusPedido {
  PENDENTE
  PAGO
  CANCELADO
  ENVIADO
  ENTREGUE
}

enum StatusPagamento {
  PENDENTE
  APROVADO
  REJEITADO
  REEMBOLSADO
}

enum TipoTamanho {
  NUMERICO
  LETRA
}
